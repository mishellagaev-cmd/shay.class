import React, { useState, useEffect, createContext, useContext } from 'react';
import { 
  BrowserRouter as Router, 
  Routes, 
  Route, 
  Link, 
  useParams, 
  useNavigate, 
  useLocation 
} from 'react-router-dom';
import { 
  Home, 
  BookOpen, 
  Users, 
  Calendar, 
  Settings,
  LogOut,
  Bell,
  User,
  Search,
  Plus,
  Filter,
  ArrowLeft,
  Save,
  Mail,
  Phone,
  Pencil,
  Archive,
  TrendingUp
} from 'lucide-react';

// ==================== TYPES ====================
interface User {
  id: string;
  name: string;
  email: string;
  role: 'admin' | 'instructor' | 'student';
}

interface Course {
  id: string;
  title: string;
  description: string;
  instructor: string;
  startDate: Date;
  endDate: Date;
  status: 'draft' | 'active' | 'archived';
  enrolledCount: number;
}

interface Student {
  id: string;
  name: string;
  email: string;
  phone: string;
  enrolledSince: Date;
  enrolledCourses: number;
  lastActive: Date;
}

interface AuthState {
  isAuthenticated: boolean;
  user: User | null;
  login: (email: string, password: string) => Promise<void>;
  logout: () => void;
}

// ==================== CONTEXT ====================
const AuthContext = createContext<AuthState | undefined>(undefined);

const mockUsers: User[] = [
  { id: '1', name: 'Admin User', email: 'admin@example.com', role: 'admin' },
  { id: '2', name: 'John Instructor', email: 'john@example.com', role: 'instructor' },
  { id: '3', name: 'Jane Student', email: 'jane@example.com', role: 'student' }
];

const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [user, setUser] = useState<User | null>(null);

  const login = async (email: string, password: string) => {
    await new Promise(resolve => setTimeout(resolve, 500));
    
    const foundUser = mockUsers.find(u => u.email === email);
    if (foundUser && password === 'password') {
      setIsAuthenticated(true);
      setUser(foundUser);
      return;
    }
    
    throw new Error('Invalid credentials');
  };

  const logout = () => {
    setIsAuthenticated(false);
    setUser(null);
  };

  return (
    <AuthContext.Provider value={{ isAuthenticated, user, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
};

const useAuth = (): AuthState => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};

// ==================== HOOKS ====================
const useCourses = () => {
  const [courses, setCourses] = useState<Course[]>([
    {
      id: '1',
      title: 'Advanced React Patterns',
      description: 'Learn advanced patterns and techniques for building scalable React applications',
      instructor: 'John Smith',
      startDate: new Date('2023-05-01'),
      endDate: new Date('2023-08-31'),
      status: 'active',
      enrolledCount: 42
    },
    {
      id: '2',
      title: 'TypeScript Fundamentals',
      description: 'Master TypeScript basics and advanced features',
      instructor: 'Jane Doe',
      startDate: new Date('2023-06-01'),
      endDate: new Date('2023-09-30'),
      status: 'draft',
      enrolledCount: 0
    },
    {
      id: '3',
      title: 'Node.js Backend Development',
      description: 'Build scalable backend services with Node.js and Express',
      instructor: 'Mike Johnson',
      startDate: new Date('2023-04-01'),
      endDate: new Date('2023-07-31'),
      status: 'active',
      enrolledCount: 38
    }
  ]);

  const addCourse = (course: Omit<Course, 'id'>) => {
    const newCourse: Course = {
      ...course,
      id: `${courses.length + 1}`
    };
    setCourses([...courses, newCourse]);
  };

  const updateCourse = (id: string, updatedCourse: Partial<Course>) => {
    setCourses(courses.map(course => 
      course.id === id ? { ...course, ...updatedCourse } : course
    ));
  };

  return { courses, addCourse, updateCourse };
};

const useStudents = () => {
  const [students, setStudents] = useState<Student[]>([
    {
      id: '1',
      name: 'Alice Johnson',
      email: 'alice@example.com',
      phone: '(555) 123-4567',
      enrolledSince: new Date('2022-09-15'),
      enrolledCourses: 3,
      lastActive: new Date('2023-04-15')
    },
    {
      id: '2',
      name: 'Bob Smith',
      email: 'bob@example.com',
      phone: '(555) 234-5678',
      enrolledSince: new Date('2022-10-01'),
      enrolledCourses: 2,
      lastActive: new Date('2023-04-18')
    },
    {
      id: '3',
      name: 'Carol Davis',
      email: 'carol@example.com',
      phone: '(555) 345-6789',
      enrolledSince: new Date('2022-11-15'),
      enrolledCourses: 4,
      lastActive: new Date('2023-04-20')
    }
  ]);

  return { students };
};

// ==================== COMPONENTS ====================
const PrivateRoute: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const { isAuthenticated } = useAuth();
  return isAuthenticated ? <>{children}</> : <Navigate to="/login" />;
};

const Layout: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  return (
    <div className="flex h-screen bg-slate-50">
      <Sidebar />
      <div className="flex flex-col flex-1 overflow-hidden">
        <Header />
        <main className="flex-1 overflow-y-auto p-4 md:p-6">
          {children}
        </main>
      </div>
    </div>
  );
};

const Header: React.FC = () => {
  const { user, logout } = useAuth();
  
  return (
    <header className="bg-white shadow-sm z-10">
      <div className="flex items-center justify-between px-4 py-3 sm:px-6">
        <div></div>
        <div className="flex items-center space-x-4">
          <button className="p-1 rounded-full text-slate-500 hover:text-slate-700 focus:outline-none">
            <Bell size={20} />
          </button>
          <div className="relative">
            <button className="flex items-center text-sm focus:outline-none">
              <div className="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center text-white">
                <User size={18} />
              </div>
              <span className="ml-2 hidden md:block text-slate-700">{user?.name}</span>
            </button>
            <div className="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden">
              <button 
                onClick={logout}
                className="block w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100"
              >
                Sign out
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>
  );
};

const Sidebar: React.FC = () => {
  const location = useLocation();
  const { logout } = useAuth();
  
  const navigation = [
    { name: 'Dashboard', href: '/', icon: Home },
    { name: 'Courses', href: '/courses', icon: BookOpen },
    { name: 'Students', href: '/students', icon: Users },
    { name: 'Calendar', href: '#', icon: Calendar },
    { name: 'Settings', href: '#', icon: Settings },
  ];

  return (
    <div className="hidden md:flex md:flex-shrink-0">
      <div className="flex flex-col w-64 bg-white border-r border-slate-200">
        <div className="flex items-center flex-shrink-0 px-4 py-5">
          <h1 className="text-xl font-bold text-blue-600">Course Manager</h1>
        </div>
        <nav className="mt-5 flex-1 px-2 space-y-1">
          {navigation.map((item) => {
            const isActive = location.pathname === item.href;
            return (
              <Link
                key={item.name}
                to={item.href}
                className={`${
                  isActive
                    ? 'bg-blue-50 text-blue-600'
                    : 'text-slate-700 hover:bg-slate-50 hover:text-slate-900'
                } group flex items-center px-2 py-2 text-sm font-medium rounded-md`}
              >
                <item.icon
                  className={`${
                    isActive ? 'text-blue-600' : 'text-slate-400 group-hover:text-slate-500'
                  } mr-3 flex-shrink-0 h-5 w-5`}
                  aria-hidden="true"
                />
                {item.name}
              </Link>
            );
          })}
        </nav>
        <div className="flex flex-shrink-0 p-4 border-t border-slate-200">
          <button
            onClick={logout}
            className="flex items-center text-sm font-medium text-slate-700 hover:text-slate-900"
          >
            <LogOut className="mr-3 h-5 w-5 text-slate-400" />
            Logout
          </button>
        </div>
      </div>
    </div>
  );
};

const Card: React.FC<{ children: React.ReactNode; className?: string }> = ({ 
  children, 
  className = '' 
}) => {
  return (
    <div className={`bg-white shadow-md rounded-lg overflow-hidden ${className}`}>
      {children}
    </div>
  );
};

const Button: React.FC<{
  children: React.ReactNode;
  variant?: 'primary' | 'secondary' | 'ghost';
  isLoading?: boolean;
  className?: string;
  [key: string]: any;
}> = ({
  children,
  variant = 'primary',
  isLoading = false,
  className = '',
  ...props
}) => {
  const baseClasses = "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200";
  
  const variantClasses = {
    primary: "bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",
    secondary: "bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 focus:ring-blue-500",
    ghost: "text-blue-600 hover:bg-blue-50 focus:ring-blue-500"
  };
  
  const disabledClass = isLoading ? 'opacity-75 cursor-not-allowed' : '';
  
  return (
    <button
      className={`${baseClasses} ${variantClasses[variant]} ${disabledClass} ${className}`}
      disabled={isLoading}
      {...props}
    >
      {isLoading && (
        <svg className="animate-spin -ml-1 mr-2 h-4 w-4 text-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
          <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      )}
      {children}
    </button>
  );
};

const InputField: React.FC<{
  label: string;
  error?: string;
  className?: string;
  [key: string]: any;
}> = ({
  label,
  error,
  className = '',
  ...props
}) => {
  return (
    <div className="mb-4">
      <label className="block text-sm font-medium text-slate-700 mb-1">
        {label}
      </label>
      <input
        className={`w-full px-3 py-2 border ${
          error ? 'border-red-500' : 'border-slate-300'
        } rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${className}`}
        {...props}
      />
      {error && <p className="mt-1 text-sm text-red-600">{error}</p>}
    </div>
  );
};

const CourseCard: React.FC<{ course: Course }> = ({ course }) => {
  const getStatusColor = (status: string) => {
    switch (status) {
      case 'active': return 'bg-green-100 text-green-800';
      case 'draft': return 'bg-yellow-100 text-yellow-800';
      case 'archived': return 'bg-slate-100 text-slate-800';
      default: return 'bg-slate-100 text-slate-800';
    }
  };
  
  return (
    <div className="bg-white border border-slate-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200">
      <div className="p-5">
        <div className="flex justify-between items-start">
          <div>
            <h3 className="text-lg font-semibold text-slate-900 line-clamp-1">
              {course.title}
            </h3>
            <p className="mt-1 text-sm text-slate-500 line-clamp-2">
              {course.description}
            </p>
          </div>
          <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusColor(course.status)}`}>
            {course.status.charAt(0).toUpperCase() + course.status.slice(1)}
          </span>
        </div>
        
        <div className="mt-4 flex items-center text-sm text-slate-500">
          <BookOpen className="flex-shrink-0 mr-1.5 h-4 w-4 text-slate-400" />
          <span>Instructor: {course.instructor}</span>
        </div>
        
        <div className="mt-2 flex items-center text-sm text-slate-500">
          <Users className="flex-shrink-0 mr-1.5 h-4 w-4 text-slate-400" />
          <span>{course.enrolledCount} enrolled</span>
        </div>
        
        <div className="mt-4 flex justify-between">
          <Link 
            to={`/courses/${course.id}`} 
            className="text-sm font-medium text-blue-600 hover:text-blue-500"
          >
            View Details
          </Link>
          <Link 
            to={`/courses/edit/${course.id}`} 
            className="text-sm font-medium text-slate-600 hover:text-slate-500"
          >
            Edit
          </Link>
        </div>
      </div>
    </div>
  );
};

const StudentCard: React.FC<{ student: Student }> = ({ student }) => {
  return (
    <div className="bg-white border border-slate-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200">
      <div className="p-5">
        <div className="flex items-start">
          <div className="flex-shrink-0">
            <div className="bg-slate-200 border-2 border-dashed rounded-xl w-16 h-16" />
          </div>
          <div className="ml-4 flex-1">
            <h3 className="text-lg font-semibold text-slate-900">{student.name}</h3>
            <p className="text-sm text-slate-500 truncate">{student.email}</p>
            <div className="mt-2 flex items-center text-sm text-slate-500">
              <BookOpen className="flex-shrink-0 mr-1.5 h-4 w-4 text-slate-400" />
              <span>{student.enrolledCourses} courses</span>
            </div>
            <div className="mt-1 flex items-center text-sm text-slate-500">
              <Calendar className="flex-shrink-0 mr-1.5 h-4 w-4 text-slate-400" />
              <span>Last active {student.lastActive.toLocaleDateString()}</span>
            </div>
          </div>
        </div>
        
        <div className="mt-4">
          <Link 
            to={`/students/${student.id}`} 
            className="text-sm font-medium text-blue-600 hover:text-blue-500"
          >
            View Profile
          </Link>
        </div>
      </div>
    </div>
  );
};

// ==================== PAGES ====================
const LoginPage: React.FC = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  
  const navigate = useNavigate();
  const { login } = useAuth();
  
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    setError('');
    
    try {
      await login(email, password);
      navigate('/');
    } catch (err) {
      setError('Invalid email or password');
    } finally {
      setIsLoading(false);
    }
  };
  
  return (
    <div className="min-h-screen flex items-center justify-center bg-slate-50 py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-md w-full space-y-8">
        <div>
          <div className="mx-auto h-12 w-12 rounded-full bg-blue-600 flex items-center justify-center">
            <User className="h-6 w-6 text-white" />
          </div>
          <h2 className="mt-6 text-center text-3xl font-extrabold text-slate-900">
            Sign in to your account
          </h2>
          <p className="mt-2 text-center text-sm text-slate-600">
            Use admin@example.com / password for testing
          </p>
        </div>
        <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
          <div className="rounded-md shadow-sm -space-y-px">
            <div className="mb-4">
              <InputField
                id="email"
                name="email"
                type="email"
                autoComplete="email"
                required
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                placeholder="Email address"
                error={error}
              />
            </div>
            <div>
              <InputField
                id="password"
                name="password"
                type="password"
                autoComplete="current-password"
                required
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                placeholder="Password"
                error={error}
              />
            </div>
          </div>
          
          <div className="flex items-center justify-between">
            <div className="flex items-center">
              <input
                id="remember-me"
                name="remember-me"
                type="checkbox"
                className="h-4 w-4 text-blue-600 focus:ring-blue-500 border-slate-300 rounded"
              />
              <label htmlFor="remember-me" className="ml-2 block text-sm text-slate-700">
                Remember me
              </label>
            </div>
            
            <div className="text-sm">
              <a href="#" className="font-medium text-blue-600 hover:text-blue-500">
                Forgot your password?
              </a>
            </div>
          </div>
          
          <div>
            <Button
              type="submit"
              isLoading={isLoading}
              className="w-full"
            >
              Sign in
            </Button>
          </div>
        </form>
      </div>
    </div>
  );
};

const DashboardPage: React.FC = () => {
  const stats = [
    { name: 'Total Courses', value: '24', change: '+4%', icon: BookOpen },
    { name: 'Active Students', value: '1,240', change: '+12%', icon: Users },
    { name: 'Upcoming Deadlines', value: '8', change: '-2%', icon: Calendar },
    { name: 'Completion Rate', value: '82%', change: '+5%', icon: TrendingUp },
  ];
  
  return (
    <div>
      <div className="mb-6">
        <h1 className="text-2xl font-bold text-slate-900">Dashboard</h1>
        <p className="mt-1 text-slate-600">Welcome back! Here's what's happening today.</p>
      </div>
      
      <div className="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-6">
        {stats.map((stat) => (
          <Card key={stat.name}>
            <div className="p-5">
              <div className="flex items-center">
                <div className="flex-shrink-0 bg-blue-100 p-3 rounded-full">
                  <stat.icon className="h-6 w-6 text-blue-600" />
                </div>
                <div className="ml-4">
                  <p className="text-sm font-medium text-slate-600 truncate">{stat.name}</p>
                  <p className="text-2xl font-semibold text-slate-900">{stat.value}</p>
                </div>
              </div>
              <div className="mt-4">
                <p className="text-xs text-slate-500">
                  <span className={stat.change.startsWith('+') ? 'text-green-600' : 'text-red-600'}>
                    {stat.change}
                  </span> from last month
                </p>
              </div>
            </div>
          </Card>
        ))}
      </div>
      
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <Card className="lg:col-span-1">
          <div className="p-5">
            <h3 className="text-lg font-medium text-slate-900 mb-4">Recent Activity</h3>
            <ul className="divide-y divide-slate-200">
              {[1, 2, 3].map((item) => (
                <li key={item} className="py-4">
                  <div className="flex items-start">
                    <div className="bg-slate-200 border-2 border-dashed rounded-xl w-16 h-16" />
                    <div className="ml-4">
                      <h4 className="text-sm font-medium text-slate-900">New student enrollment</h4>
                      <p className="text-sm text-slate-500">Jane Cooper enrolled in Advanced React</p>
                      <p className="text-xs text-slate-400 mt-1">2 hours ago</p>
                    </div>
                  </div>
                </li>
              ))}
            </ul>
          </div>
        </Card>
        
        <Card className="lg:col-span-1">
          <div className="p-5">
            <h3 className="text-lg font-medium text-slate-900 mb-4">Upcoming Courses</h3>
            <div className="space-y-4">
              {[1, 2].map((item) => (
                <div key={item} className="flex items-center p-3 bg-slate-50 rounded-lg">
                  <div className="bg-slate-200 border-2 border-dashed rounded-xl w-12 h-12" />
                  <div className="ml-4">
                    <h4 className="text-sm font-medium text-slate-900">Advanced JavaScript</h4>
                    <p className="text-xs text-slate-500">Starts May 15, 2023</p>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </Card>
      </div>
    </div>
  );
};

const CourseListPage: React.FC = () => {
  const [searchTerm, setSearchTerm] = useState('');
  const [statusFilter, setStatusFilter] = useState('all');
  const { courses } = useCourses();
  
  const filteredCourses = courses.filter(course => {
    const matchesSearch = course.title.toLowerCase().includes(searchTerm.toLowerCase()) || 
                          course.description.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesStatus = statusFilter === 'all' || course.status === statusFilter;
    return matchesSearch && matchesStatus;
  });
  
  return (
    <div>
      <div className="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
        <div>
          <h1 className="text-2xl font-bold text-slate-900">Courses</h1>
          <p className="mt-1 text-slate-600">Manage your course catalog</p>
        </div>
        <div className="mt-4 md:mt-0">
          <Link to="/courses/new">
            <Button>
              <Plus className="mr-2 h-4 w-4" />
              Create Course
            </Button>
          </Link>
        </div>
      </div>
      
      <div className="bg-white shadow-md rounded-lg overflow-hidden mb-6">
        <div className="p-4 border-b border-slate-200 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
          <div className="relative flex-1 max-w-md">
            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <Search className="h-5 w-5 text-slate-400" />
            </div>
            <input
              type="text"
              className="block w-full pl-10 pr-3 py-2 border border-slate-300 rounded-md leading-5 bg-white placeholder-slate-500 focus:outline-none focus:placeholder-slate-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              placeholder="Search courses..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
          </div>
          
          <div className="flex items-center space-x-3">
            <div className="relative">
              <select
                className="block w-full pl-3 pr-10 py-2 text-base border border-slate-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"
                value={statusFilter}
                onChange={(e) => setStatusFilter(e.target.value)}
              >
                <option value="all">All Statuses</option>
                <option value="active">Active</option>
                <option value="draft">Draft</option>
                <option value="archived">Archived</option>
              </select>
            </div>
            <Button variant="secondary">
              <Filter className="mr-2 h-4 w-4" />
              Filters
            </Button>
          </div>
        </div>
        
        <div className="p-4">
          {filteredCourses.length > 0 ? (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {filteredCourses.map(course => (
                <CourseCard key={course.id} course={course} />
              ))}
            </div>
          ) : (
            <div className="text-center py-12">
              <p className="text-slate-500">No courses found matching your criteria</p>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

const CourseDetailPage: React.FC = () => {
  const { id } = useParams<{ id: string }>();
  const { courses } = useCourses();
  const { students } = useStudents();
  const navigate = useNavigate();
  
  const course = courses.find(c => c.id === id);
  
  if (!course) {
    return <div>Course not found</div>;
  }
  
  // Find students enrolled in this course
  const enrolledStudents = students.slice(0, 3); // Just show first 3 for demo
  
  return (
    <div>
      <div className="mb-6">
        <button 
          onClick={() => navigate(-1)}
          className="inline-flex items-center text-sm font-medium text-blue-600 hover:text-blue-500 mb-4"
        >
          <ArrowLeft className="mr-1 h-4 w-4" />
          Back to courses
        </button>
        <div className="flex flex-col md:flex-row md:items-start md:justify-between">
          <div>
            <h1 className="text-2xl font-bold text-slate-900">{course.title}</h1>
            <p className="mt-1 text-slate-600">{course.description}</p>
          </div>
          <div className="mt-4 md:mt-0 flex space-x-2">
            <Link to={`/courses/edit/${course.id}`}>
              <Button variant="secondary">
                <Pencil className="mr-2 h-4 w-4" />
                Edit
              </Button>
            </Link>
            <Button variant="secondary">
              <Archive className="mr-2 h-4 w-4" />
              Archive
            </Button>
          </div>
        </div>
      </div>
      
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div className="lg:col-span-2 space-y-6">
          <Card>
            <div className="p-5">
              <h2 className="text-lg font-medium text-slate-900 mb-4">Course Details</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <dt className="text-sm font-medium text-slate-500">Instructor</dt>
                  <dd className="mt-1 text-sm text-slate-900">{course.instructor}</dd>
                </div>
                <div>
                  <dt className="text-sm font-medium text-slate-500">Status</dt>
                  <dd className="mt-1">
                    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                      course.status === 'active' 
                        ? 'bg-green-100 text-green-800' 
                        : course.status === 'draft' 
                          ? 'bg-yellow-100 text-yellow-800' 
                          : 'bg-slate-100 text-slate-800'
                    }`}>
                      {course.status.charAt(0).toUpperCase() + course.status.slice(1)}
                    </span>
                  </dd>
                </div>
                <div>
                  <dt className="text-sm font-medium text-slate-500">Start Date</dt>
                  <dd className="mt-1 text-sm text-slate-900">
                    {course.startDate.toLocaleDateString()}
                  </dd>
                </div>
                <div>
                  <dt className="text-sm font-medium text-slate-500">End Date</dt>
                  <dd className="mt-1 text-sm text-slate-900">
                    {course.endDate.toLocaleDateString()}
                  </dd>
                </div>
              </div>
            </div>
          </Card>
          
          <Card>
            <div className="p-5">
              <h2 className="text-lg font-medium text-slate-900 mb-4">Enrolled Students</h2>
              <div className="overflow-hidden">
                <table className="min-w-full divide-y divide-slate-200">
                  <thead className="bg-slate-50">
                    <tr>
                      <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                        Name
                      </th>
                      <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                        Email
                      </th>
                      <th scope="col" className="relative px-6 py-3">
                        <span className="sr-only">Actions</span>
                      </th>
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-slate-200">
                    {enrolledStudents.map((student) => (
                      <tr key={student.id}>
                        <td className="px-6 py-4 whitespace-nowrap">
                          <div className="flex items-center">
                            <div className="flex-shrink-0 h-10 w-10">
                              <div className="bg-slate-200 border-2 border-dashed rounded-xl w-10 h-10" />
                            </div>
                            <div className="ml-4">
                              <div className="text-sm font-medium text-slate-900">{student.name}</div>
                            </div>
                          </div>
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-500">
                          {student.email}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                          <Link to={`/students/${student.id}`} className="text-blue-600 hover:text-blue-900">
                            View Profile
                          </Link>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          </Card>
        </div>
        
        <div className="space-y-6">
          <Card>
            <div className="p-5">
              <h2 className="text-lg font-medium text-slate-900 mb-4">Quick Actions</h2>
              <div className="space-y-3">
                <Button variant="secondary" className="w-full justify-center">
                  Add Students
                </Button>
                <Button variant="secondary" className="w-full justify-center">
                  Manage Content
                </Button>
                <Button variant="secondary" className="w-full justify-center">
                  View Analytics
                </Button>
              </div>
            </div>
          </Card>
          
          <Card>
            <div className="p-5">
              <h2 className="text-lg font-medium text-slate-900 mb-4">Course Progress</h2>
              <div className="space-y-4">
                <div>
                  <div className="flex justify-between text-sm mb-1">
                    <span className="font-medium text-slate-700">Completion Rate</span>
                    <span className="text-slate-500">72%</span>
                  </div>
                  <div className="w-full bg-slate-200 rounded-full h-2">
                    <div className="bg-blue-600 h-2 rounded-full" style={{ width: '72%' }}></div>
                  </div>
                </div>
                <div>
                  <div className="flex justify-between text-sm mb-1">
                    <span className="font-medium text-slate-700">Assignments Completed</span>
                    <span className="text-slate-500">18/24</span>
                  </div>
                  <div className="w-full bg-slate-200 rounded-full h-2">
                    <div className="bg-green-500 h-2 rounded-full" style={{ width: '75%' }}></div>
                  </div>
                </div>
              </div>
            </div>
          </Card>
        </div>
      </div>
    </div>
  );
};

const CourseFormPage: React.FC = () => {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [formData, setFormData] = useState({
    title: '',
    description: '',
    instructor: '',
    startDate: new Date().toISOString().split('T')[0],
    endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
    status: 'draft' as 'draft' | 'active' | 'archived'
  });
  const [errors, setErrors] = useState<Record<string, string>>({});
  const { addCourse, courses } = useCourses();
  
  // If editing, populate form with existing data
  useEffect(() => {
    if (id) {
      const course = courses.find(c => c.id === id);
      if (course) {
        setFormData({
          title: course.title,
          description: course.description,
          instructor: course.instructor,
          startDate: course.startDate.toISOString().split('T')[0],
          endDate: course.endDate.toISOString().split('T')[0],
          status: course.status
        });
      }
    }
  }, [id, courses]);
  
  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
    
    // Clear error when field is changed
    if (errors[name]) {
      setErrors(prev => {
        const newErrors = { ...prev };
        delete newErrors[name];
        return newErrors;
      });
    }
  };
  
  const validate = () => {
    const newErrors: Record<string, string> = {};
    if (!formData.title.trim()) newErrors.title = 'Title is required';
    if (!formData.description.trim()) newErrors.description = 'Description is required';
    if (!formData.instructor) newErrors.instructor = 'Instructor is required';
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };
  
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!validate()) return;
    
    setIsSubmitting(true);
    // Simulate API call
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    if (id) {
      // Update existing course
      console.log('Updating course:', formData);
    } else {
      // Create new course
      addCourse({
        title: formData.title,
        description: formData.description,
        instructor: formData.instructor,
        startDate: new Date(formData.startDate),
        endDate: new Date(formData.endDate),
        status: formData.status,
        enrolledCount: 0
      });
    }
    
    setIsSubmitting(false);
    navigate('/courses');
  };
  
  // Mock instructors
  const instructors = [
    { id: '1', name: 'John Smith' },
    { id: '2', name: 'Jane Doe' },
    { id: '3', name: 'Mike Johnson' }
  ];
  
  return (
    <div>
      <div className="mb-6">
        <button 
          onClick={() => navigate(-1)}
          className="inline-flex items-center text-sm font-medium text-blue-600 hover:text-blue-500 mb-4"
        >
          <ArrowLeft className="mr-1 h-4 w-4" />
          Back
        </button>
        <h1 className="text-2xl font-bold text-slate-900">
          {id ? 'Edit Course' : 'Create New Course'}
        </h1>
        <p className="mt-1 text-slate-600">
          {id ? 'Update course information' : 'Fill in the details for your new course'}
        </p>
      </div>
      
      <Card>
        <div className="p-5">
          <form onSubmit={handleSubmit} className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <InputField
                  label="Course Title"
                  name="title"
                  value={formData.title}
                  onChange={handleChange}
                  error={errors.title}
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-slate-700 mb-1">
                  Instructor
                </label>
                <select
                  name="instructor"
                  value={formData.instructor}
                  onChange={handleChange}
                  className={`w-full px-3 py-2 border ${
                    errors.instructor ? 'border-red-500' : 'border-slate-300'
                  } rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500`}
                >
                  <option value="">Select an instructor</option>
                  {instructors.map(instructor => (
                    <option key={instructor.id} value={instructor.id}>
                      {instructor.name}
                    </option>
                  ))}
                </select>
                {errors.instructor && (
                  <p className="mt-1 text-sm text-red-600">{errors.instructor}</p>
                )}
              </div>
              
              <div>
                <InputField
                  label="Start Date"
                  type="date"
                  name="startDate"
                  value={formData.startDate}
                  onChange={handleChange}
                  error={errors.startDate}
                />
              </div>
              
              <div>
                <InputField
                  label="End Date"
                  type="date"
                  name="endDate"
                  value={formData.endDate}
                  onChange={handleChange}
                  error={errors.endDate}
                />
              </div>
              
              <div className="md:col-span-2">
                <label className="block text-sm font-medium text-slate-700 mb-1">
                  Description
                </label>
                <textarea
                  name="description"
                  value={formData.description}
                  onChange={handleChange}
                  rows={4}
                  className={`w-full px-3 py-2 border ${
                    errors.description ? 'border-red-500' : 'border-slate-300'
                  } rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500`}
                />
                {errors.description && (
                  <p className="mt-1 text-sm text-red-600">{errors.description}</p>
                )}
              </div>
              
              <div>
                <label className="block text-sm font-medium text-slate-700 mb-1">
                  Status
                </label>
                <div className="grid grid-cols-3 gap-3">
                  {(['draft', 'active', 'archived'] as const).map(status => (
                    <label 
                      key={status} 
                      className="border rounded-md px-3 py-2 flex items-center cursor-pointer"
                    >
                      <input
                        type="radio"
                        name="status"
                        value={status}
                        checked={formData.status === status}
                        onChange={handleChange}
                        className="sr-only"
                      />
                      <div className="flex items-center h-5">
                        <div className="h-4 w-4 rounded-full border border-slate-300 flex items-center justify-center">
                          <div className={`h-2 w-2 rounded-full bg-blue-600 ${formData.status === status ? '' : 'hidden'}`}></div>
                        </div>
                      </div>
                      <div className="ml-3 text-sm">
                        <span className="font-medium text-slate-900 capitalize">{status}</span>
                      </div>
                    </label>
                  ))}
                </div>
              </div>
            </div>
            
            <div className="flex justify-end space-x-3 pt-4">
              <Button 
                type="button" 
                variant="secondary" 
                onClick={() => navigate('/courses')}
              >
                Cancel
              </Button>
              <Button type="submit" isLoading={isSubmitting}>
                <Save className="mr-2 h-4 w-4" />
                {id ? 'Update Course' : 'Create Course'}
              </Button>
            </div>
          </form>
        </div>
      </Card>
    </div>
  );
};

const StudentListPage: React.FC = () => {
  const [searchTerm, setSearchTerm] = useState('');
  const { students } = useStudents();
  
  const filteredStudents = students.filter(student => 
    student.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
    student.email.toLowerCase().includes(searchTerm.toLowerCase())
  );
  
  return (
    <div>
      <div className="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
        <div>
          <h1 className="text-2xl font-bold text-slate-900">Students</h1>
          <p className="mt-1 text-slate-600">Manage student enrollments and progress</p>
        </div>
      </div>
      
      <div className="bg-white shadow-md rounded-lg overflow-hidden mb-6">
        <div className="p-4 border-b border-slate-200">
          <div className="relative max-w-md">
            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <Search className="h-5 w-5 text-slate-400" />
            </div>
            <input
              type="text"
              className="block w-full pl-10 pr-3 py-2 border border-slate-300 rounded-md leading-5 bg-white placeholder-slate-500 focus:outline-none focus:placeholder-slate-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              placeholder="Search students..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
          </div>
        </div>
        
        <div className="p-4">
          {filteredStudents.length > 0 ? (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {filteredStudents.map(student => (
                <StudentCard key={student.id} student={student} />
              ))}
            </div>
          ) : (
            <div className="text-center py-12">
              <Users className="mx-auto h-12 w-12 text-slate-400" />
              <h3 className="mt-2 text-sm font-medium text-slate-900">No students found</h3>
              <p className="mt-1 text-sm text-slate-500">
                Try adjusting your search to find what you're looking for.
              </p>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

const StudentDetailPage: React.FC = () => {
  const { id } = useParams<{ id: string }>();
  const { students } = useStudents();
  const navigate = useNavigate();
  
  const student = students.find(s => s.id === id);
  
  if (!student) {
    return <div>Student not found</div>;
  }
  
  // Mock enrolled courses
  const enrolledCourses = [
    {
      id: '1',
      title: 'Advanced React Patterns',
      progress: 72,
      instructor: 'John Smith'
    },
    {
      id: '3',
      title: 'Node.js Backend Development',
      progress: 45,
      instructor: 'Mike Johnson'
    }
  ];
  
  return (
    <div>
      <div className="mb-6">
        <button 
          onClick={() => navigate(-1)}
          className="inline-flex items-center text-sm font-medium text-blue-600 hover:text-blue-500 mb-4"
        >
          <ArrowLeft className="mr-1 h-4 w-4" />
          Back to students
        </button>
        <div className="flex flex-col md:flex-row md:items-start">
          <div className="flex-shrink-0">
            <div className="bg-slate-200 border-2 border-dashed rounded-xl w-24 h-24" />
          </div>
          <div className="mt-4 md:mt-0 md:ml-6">
            <h1 className="text-2xl font-bold text-slate-900">{student.name}</h1>
            <p className="mt-1 text-slate-600">{student.email}</p>
            <div className="mt-4 flex flex-wrap gap-4">
              <div className="flex items-center text-sm text-slate-500">
                <Mail className="flex-shrink-0 mr-1.5 h-4 w-4 text-slate-400" />
                <span>{student.email}</span>
              </div>
              <div className="flex items-center text-sm text-slate-500">
                <Phone className="flex-shrink-0 mr-1.5 h-4 w-4 text-slate-400" />
                <span>{student.phone}</span>
              </div>
              <div className="flex items-center text-sm text-slate-500">
                <Calendar className="flex-shrink-0 mr-1.5 h-4 w-4 text-slate-400" />
                <span>Enrolled since {student.enrolledSince.toLocaleDateString()}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div className="lg:col-span-2 space-y-6">
          <Card>
            <div className="p-5">
              <h2 className="text-lg font-medium text-slate-900 mb-4">Enrolled Courses</h2>
              <div className="overflow-hidden">
                <table className="min-w-full divide-y divide-slate-200">
                  <thead className="bg-slate-50">
                    <tr>
                      <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                        Course
                      </th>
                      <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                        Instructor
                      </th>
                      <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                        Progress
                      </th>
                      <th scope="col" className="relative px-6 py-3">
                        <span className="sr-only">Actions</span>
                      </th>
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-slate-200">
                    {enrolledCourses.map((course) => (
                      <tr key={course.id}>
                        <td className="px-6 py-4 whitespace-nowrap">
                          <div className="text-sm font-medium text-slate-900">{course.title}</div>
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-500">
                          {course.instructor}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap">
                          <div className="flex items-center">
                            <div className="w-full bg-slate-200 rounded-full h-2">
                              <div 
                                className="bg-blue-600 h-2 rounded-full" 
                                style={{ width: `${course.progress}%` }}
                              ></div>
                            </div>
                            <span className="ml-2 text-sm text-slate-500">{course.progress}%</span>
                          </div>
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                          <Link to={`/courses/${course.id}`} className="text-blue-600 hover:text-blue-900">
                            View Course
                          </Link>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          </Card>
        </div>
        
        <div className="space-y-6">
          <Card>
            <div className="p-5">
              <h2 className="text-lg font-medium text-slate-900 mb-4">Quick Actions</h2>
              <div className="space-y-3">
                <Button variant="secondary" className="w-full justify-center">
                  Send Message
                </Button>
                <Button variant="secondary" className="w-full justify-center">
                  View Transcript
                </Button>
                <Button variant="secondary" className="w-full justify-center">
                  Reset Password
                </Button>
              </div>
            </div>
          </Card>
          
          <Card>
            <div className="p-5">
              <h2 className="text-lg font-medium text-slate-900 mb-4">Activity Summary</h2>
              <div className="space-y-4">
                <div>
                  <div className="flex justify-between text-sm mb-1">
                    <span className="font-medium text-slate-700">Assignments Submitted</span>
                    <span className="text-slate-500">12/15</span>
                  </div>
                  <div className="w-full bg-slate-200 rounded-full h-2">
                    <div className="bg-green-500 h-2 rounded-full" style={{ width: '80%' }}></div>
                  </div>
                </div>
                <div>
                  <div className="flex justify-between text-sm mb-1">
                    <span className="font-medium text-slate-700">Quizzes Passed</span>
                    <span className="text-slate-500">8/10</span>
                  </div>
                  <div className="w-full bg-slate-200 rounded-full h-2">
                    <div className="bg-blue-500 h-2 rounded-full" style={{ width: '80%' }}></div>
                  </div>
                </div>
              </div>
            </div>
          </Card>
        </div>
      </div>
    </div>
  );
};

// ==================== MAIN APP ====================
const App: React.FC = () => {
  return (
    <AuthProvider>
      <Router>
        <Routes>
          <Route path="/login" element={<LoginPage />} />
          <Route element={
            <PrivateRoute>
              <Layout />
            </PrivateRoute>
          }>
            <Route path="/" element={<DashboardPage />} />
            <Route path="/courses" element={<CourseListPage />} />
            <Route path="/courses/:id" element={<CourseDetailPage />} />
            <Route path="/courses/new" element={<CourseFormPage />} />
            <Route path="/courses/edit/:id" element={<CourseFormPage />} />
            <Route path="/students" element={<StudentListPage />} />
            <Route path="/students/:id" element={<StudentDetailPage />} />
          </Route>
        </Routes>
      </Router>
    </AuthProvider>
  );
};

export default App;
